{"version":3,"file":"utilities.js","names":[],"sources":["../../../../../../../../../node_modules/.pnpm/couchbase@4.5.0/node_modules/couchbase/dist/utilities.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.expiryToTimestamp = exports.cbQsStringify = exports.nsServerStrToDuraLevel = exports.duraLevelToNsServerStr = exports.CompoundTimeout = exports.PromiseHelper = void 0;\nconst generaltypes_1 = require(\"./generaltypes\");\nconst errors_1 = require(\"./errors\");\nconst qs = __importStar(require(\"querystring\"));\n/**\n * @internal\n */\nclass PromiseHelper {\n    /**\n     * @internal\n     */\n    static wrapAsync(fn, callback) {\n        // If a callback in in use, we wrap the promise with a handler which\n        // forwards to the callback and return undefined.  If there is no\n        // callback specified.  We directly return the promise.\n        if (callback) {\n            const prom = fn();\n            prom.then((res) => callback(null, res), (err) => callback(err, null));\n            return prom;\n        }\n        return fn();\n    }\n    /**\n     * @internal\n     */\n    static wrap(fn, callback) {\n        const prom = new Promise((resolve, reject) => {\n            fn((err, res) => {\n                if (err) {\n                    reject(err);\n                }\n                else {\n                    resolve(res);\n                }\n            });\n        });\n        if (callback) {\n            prom.then((res) => callback(null, res), (err) => callback(err, null));\n        }\n        return prom;\n    }\n}\nexports.PromiseHelper = PromiseHelper;\n/**\n * @internal\n */\nclass CompoundTimeout {\n    /**\n     * @internal\n     */\n    constructor(timeout) {\n        this._start = process.hrtime();\n        this._timeout = timeout;\n    }\n    /**\n     * @internal\n     */\n    left() {\n        if (this._timeout === undefined) {\n            return undefined;\n        }\n        const period = process.hrtime(this._start);\n        const periodMs = period[0] * 1e3 + period[1] / 1e6;\n        if (periodMs > this._timeout) {\n            return 0;\n        }\n        return this._timeout - periodMs;\n    }\n    /**\n     * @internal\n     */\n    expired() {\n        const timeLeft = this.left();\n        if (timeLeft === undefined) {\n            return false;\n        }\n        return timeLeft <= 0;\n    }\n}\nexports.CompoundTimeout = CompoundTimeout;\n/**\n * @internal\n */\nfunction duraLevelToNsServerStr(level) {\n    if (level === undefined) {\n        return undefined;\n    }\n    if (typeof level === 'string') {\n        return level;\n    }\n    if (level === generaltypes_1.DurabilityLevel.None) {\n        return 'none';\n    }\n    else if (level === generaltypes_1.DurabilityLevel.Majority) {\n        return 'majority';\n    }\n    else if (level === generaltypes_1.DurabilityLevel.MajorityAndPersistOnMaster) {\n        return 'majorityAndPersistActive';\n    }\n    else if (level === generaltypes_1.DurabilityLevel.PersistToMajority) {\n        return 'persistToMajority';\n    }\n    else {\n        throw new Error('invalid durability level specified');\n    }\n}\nexports.duraLevelToNsServerStr = duraLevelToNsServerStr;\n/**\n * @internal\n */\nfunction nsServerStrToDuraLevel(level) {\n    if (level === undefined) {\n        return generaltypes_1.DurabilityLevel.None;\n    }\n    if (level === 'none') {\n        return generaltypes_1.DurabilityLevel.None;\n    }\n    else if (level === 'majority') {\n        return generaltypes_1.DurabilityLevel.Majority;\n    }\n    else if (level === 'majorityAndPersistActive') {\n        return generaltypes_1.DurabilityLevel.MajorityAndPersistOnMaster;\n    }\n    else if (level === 'persistToMajority') {\n        return generaltypes_1.DurabilityLevel.PersistToMajority;\n    }\n    else {\n        throw new Error('invalid durability level string');\n    }\n}\nexports.nsServerStrToDuraLevel = nsServerStrToDuraLevel;\n/**\n * @internal\n */\nfunction cbQsStringify(values, options) {\n    const cbValues = {};\n    for (const i in values) {\n        if (values[i] === undefined) {\n            // skipped\n        }\n        else if (typeof values[i] === 'boolean') {\n            if (options && options.boolAsString) {\n                cbValues[i] = values[i] ? 'true' : 'false';\n            }\n            else {\n                cbValues[i] = values[i] ? 1 : 0;\n            }\n        }\n        else {\n            cbValues[i] = values[i];\n        }\n    }\n    return qs.stringify(cbValues);\n}\nexports.cbQsStringify = cbQsStringify;\nconst thirtyDaysInSeconds = 30 * 24 * 60 * 60;\n/**\n * @internal\n */\nfunction expiryToTimestamp(expiry) {\n    if (typeof expiry !== 'number') {\n        throw new errors_1.InvalidArgumentError(new Error('Expected expiry to be a number.'));\n    }\n    if (expiry < 0) {\n        throw new errors_1.InvalidArgumentError(new Error(`Expected expiry to be either zero (for no expiry) or greater but got ${expiry}.`));\n    }\n    if (expiry < thirtyDaysInSeconds) {\n        return expiry;\n    }\n    return expiry + Math.floor(Date.now() / 1000);\n}\nexports.expiryToTimestamp = expiryToTimestamp;\n"],"x_google_ignoreList":[0],"mappings":";;;;;;;;CACA,IAAI,qCAAgC,oBAAqB,OAAO,UAAU,SAAS,GAAG,GAAG,GAAG,IAAI;AAC5F,MAAI,OAAO,QAAW,KAAK;EAC3B,IAAI,OAAO,OAAO,yBAAyB,GAAG,EAAE;AAChD,MAAI,CAAC,SAAS,SAAS,OAAO,CAAC,EAAE,aAAa,KAAK,YAAY,KAAK,eAClE,OAAO;GAAE,YAAY;GAAM,KAAK,WAAW;AAAE,WAAO,EAAE;GAAK;EAAE;EAE/D,OAAO,eAAe,GAAG,IAAI,KAAK;CACrC,MAAK,SAAS,GAAG,GAAG,GAAG,IAAI;AACxB,MAAI,OAAO,QAAW,KAAK;EAC3B,EAAE,MAAM,EAAE;CACb;CACD,IAAI,wCAAmC,uBAAwB,OAAO,UAAU,SAAS,GAAG,GAAG;EAC3F,OAAO,eAAe,GAAG,WAAW;GAAE,YAAY;GAAM,OAAO;EAAG,EAAC;CACtE,KAAI,SAAS,GAAG,GAAG;EAChB,EAAE,aAAa;CAClB;CACD,IAAI,kCAA6B,gBAAiB,SAAU,KAAK;AAC7D,MAAI,OAAO,IAAI,WAAY,QAAO;EAClC,IAAI,SAAS,CAAE;AACf,MAAI,OAAO,MAAM;QAAK,IAAI,KAAK,IAAK,KAAI,MAAM,aAAa,OAAO,UAAU,eAAe,KAAK,KAAK,EAAE,EAAE,gBAAgB,QAAQ,KAAK,EAAE;EAAC;EACzI,mBAAmB,QAAQ,IAAI;AAC/B,SAAO;CACV;CACD,OAAO,eAAe,SAAS,cAAc,EAAE,OAAO,KAAM,EAAC;CAC7D,QAAQ,oBAAoB,QAAQ,gBAAgB,QAAQ,yBAAyB,QAAQ,yBAAyB,QAAQ,kBAAkB,QAAQ,gBAAgB,KAAK;CAC7K,MAAM;CACN,MAAM;CACN,MAAM,KAAK,uBAAqB,cAAc,CAAC;;;;CAI/C,IAAM,gBAAN,MAAoB;;;;EAIhB,OAAO,UAAU,IAAI,UAAU;AAI3B,OAAI,UAAU;IACV,MAAM,OAAO,IAAI;IACjB,KAAK,KAAK,CAAC,QAAQ,SAAS,MAAM,IAAI,EAAE,CAAC,QAAQ,SAAS,KAAK,KAAK,CAAC;AACrE,WAAO;GACV;AACD,UAAO,IAAI;EACd;;;;EAID,OAAO,KAAK,IAAI,UAAU;GACtB,MAAM,OAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;IAC1C,GAAG,CAAC,KAAK,QAAQ;AACb,SAAI,KACA,OAAO,IAAI;UAGX,QAAQ,IAAI;IAEnB,EAAC;GACL;AACD,OAAI,UACA,KAAK,KAAK,CAAC,QAAQ,SAAS,MAAM,IAAI,EAAE,CAAC,QAAQ,SAAS,KAAK,KAAK,CAAC;AAEzE,UAAO;EACV;CACJ;CACD,QAAQ,gBAAgB;;;;CAIxB,IAAM,kBAAN,MAAsB;;;;EAIlB,YAAY,SAAS;GACjB,KAAK,SAAS,QAAQ,QAAQ;GAC9B,KAAK,WAAW;EACnB;;;;EAID,OAAO;AACH,OAAI,KAAK,aAAa,OAClB,QAAO;GAEX,MAAM,SAAS,QAAQ,OAAO,KAAK,OAAO;GAC1C,MAAM,WAAW,OAAO,KAAK,MAAM,OAAO,KAAK;AAC/C,OAAI,WAAW,KAAK,SAChB,QAAO;AAEX,UAAO,KAAK,WAAW;EAC1B;;;;EAID,UAAU;GACN,MAAM,WAAW,KAAK,MAAM;AAC5B,OAAI,aAAa,OACb,QAAO;AAEX,UAAO,YAAY;EACtB;CACJ;CACD,QAAQ,kBAAkB;;;;CAI1B,SAAS,uBAAuB,OAAO;AACnC,MAAI,UAAU,OACV,QAAO;AAEX,MAAI,OAAO,UAAU,SACjB,QAAO;AAEX,MAAI,UAAU,eAAe,gBAAgB,KACzC,QAAO;WAEF,UAAU,eAAe,gBAAgB,SAC9C,QAAO;WAEF,UAAU,eAAe,gBAAgB,2BAC9C,QAAO;WAEF,UAAU,eAAe,gBAAgB,kBAC9C,QAAO;MAGP,OAAM,IAAI,MAAM;CAEvB;CACD,QAAQ,yBAAyB;;;;CAIjC,SAAS,uBAAuB,OAAO;AACnC,MAAI,UAAU,OACV,QAAO,eAAe,gBAAgB;AAE1C,MAAI,UAAU,OACV,QAAO,eAAe,gBAAgB;WAEjC,UAAU,WACf,QAAO,eAAe,gBAAgB;WAEjC,UAAU,2BACf,QAAO,eAAe,gBAAgB;WAEjC,UAAU,oBACf,QAAO,eAAe,gBAAgB;MAGtC,OAAM,IAAI,MAAM;CAEvB;CACD,QAAQ,yBAAyB;;;;CAIjC,SAAS,cAAc,QAAQ,SAAS;EACpC,MAAM,WAAW,CAAE;AACnB,OAAK,MAAM,KAAK,OACZ,KAAI,OAAO,OAAO,QAAW,CAE5B,WACQ,OAAO,OAAO,OAAO,UAC1B,KAAI,WAAW,QAAQ,cACnB,SAAS,KAAK,OAAO,KAAK,SAAS;OAGnC,SAAS,KAAK,OAAO,KAAK,IAAI;OAIlC,SAAS,KAAK,OAAO;AAG7B,SAAO,GAAG,UAAU,SAAS;CAChC;CACD,QAAQ,gBAAgB;CACxB,MAAM,sBAAsB,MAAU,KAAK;;;;CAI3C,SAAS,kBAAkB,QAAQ;AAC/B,MAAI,OAAO,WAAW,SAClB,OAAM,IAAI,SAAS,qCAAqB,IAAI,MAAM;AAEtD,MAAI,SAAS,EACT,OAAM,IAAI,SAAS,qCAAqB,IAAI,MAAM,CAAC,qEAAqE,EAAE,OAAO,CAAC,CAAC;AAEvI,MAAI,SAAS,oBACT,QAAO;AAEX,SAAO,SAAS,KAAK,MAAM,KAAK,KAAK,GAAG,IAAK;CAChD;CACD,QAAQ,oBAAoB"}