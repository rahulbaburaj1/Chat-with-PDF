{"version":3,"file":"index.js","names":["url: string","options: WebSocketStreamOptions"],"sources":["../../../src/chat_models/iflytek_xinghuo/index.ts"],"sourcesContent":["import WebSocket from \"ws\";\nimport { BaseChatIflytekXinghuo } from \"./common.js\";\nimport {\n  BaseWebSocketStream,\n  WebSocketStreamOptions,\n} from \"../../utils/iflytek_websocket_stream.js\";\n\nclass WebSocketStream extends BaseWebSocketStream {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  openWebSocket(url: string, options: WebSocketStreamOptions): WebSocket {\n    return new WebSocket(url, options.protocols ?? []);\n  }\n}\n\n/**\n * @example\n * ```typescript\n * const model = new ChatIflytekXinghuo();\n * const response = await model.invoke([new HumanMessage(\"Nice to meet you!\")]);\n * console.log(response);\n * ```\n */\nexport class ChatIflytekXinghuo extends BaseChatIflytekXinghuo {\n  async openWebSocketStream<WebSocketStream>(\n    options: WebSocketStreamOptions\n  ): Promise<WebSocketStream> {\n    const host = \"spark-api.xf-yun.com\";\n    const date = new Date().toUTCString();\n    const url = `GET /${this.version}/chat HTTP/1.1`;\n    const { createHmac } = await import(\"node:crypto\");\n    const hash = createHmac(\"sha256\", this.iflytekApiSecret)\n      .update(`host: ${host}\\ndate: ${date}\\n${url}`)\n      .digest(\"base64\");\n    const authorization_origin = `api_key=\"${this.iflytekApiKey}\", algorithm=\"hmac-sha256\", headers=\"host date request-line\", signature=\"${hash}\"`;\n    const authorization = Buffer.from(authorization_origin).toString(\"base64\");\n    let authWebSocketUrl = this.apiUrl;\n    authWebSocketUrl += `?authorization=${authorization}`;\n    authWebSocketUrl += `&host=${encodeURIComponent(host)}`;\n    authWebSocketUrl += `&date=${encodeURIComponent(date)}`;\n    return new WebSocketStream(authWebSocketUrl, options) as WebSocketStream;\n  }\n}\n"],"mappings":";;;;;;;;AAOA,IAAM,kBAAN,cAA8B,oBAAoB;CAGhD,cAAcA,KAAaC,SAA4C;AACrE,SAAO,IAAI,UAAU,KAAK,QAAQ,aAAa,CAAE;CAClD;AACF;;;;;;;;;AAUD,IAAa,qBAAb,cAAwC,uBAAuB;CAC7D,MAAM,oBACJA,SAC0B;EAC1B,MAAM,OAAO;EACb,MAAM,wBAAO,IAAI,QAAO,aAAa;EACrC,MAAM,MAAM,CAAC,KAAK,EAAE,KAAK,QAAQ,cAAc,CAAC;EAChD,MAAM,EAAE,YAAY,GAAG,MAAM,OAAO;EACpC,MAAM,OAAO,WAAW,UAAU,KAAK,iBAAiB,CACrD,OAAO,CAAC,MAAM,EAAE,KAAK,QAAQ,EAAE,KAAK,EAAE,EAAE,KAAK,CAAC,CAC9C,OAAO,SAAS;EACnB,MAAM,uBAAuB,CAAC,SAAS,EAAE,KAAK,cAAc,yEAAyE,EAAE,KAAK,CAAC,CAAC;EAC9I,MAAM,gBAAgB,OAAO,KAAK,qBAAqB,CAAC,SAAS,SAAS;EAC1E,IAAI,mBAAmB,KAAK;EAC5B,oBAAoB,CAAC,eAAe,EAAE,eAAe;EACrD,oBAAoB,CAAC,MAAM,EAAE,mBAAmB,KAAK,EAAE;EACvD,oBAAoB,CAAC,MAAM,EAAE,mBAAmB,KAAK,EAAE;AACvD,SAAO,IAAI,gBAAgB,kBAAkB;CAC9C;AACF"}