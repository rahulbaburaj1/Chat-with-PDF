{"version":3,"file":"retry.js","names":["original"],"sources":["../../../../../../../../../node_modules/.pnpm/retry@0.13.1/node_modules/retry/lib/retry.js"],"sourcesContent":["var RetryOperation = require('./retry_operation');\n\nexports.operation = function(options) {\n  var timeouts = exports.timeouts(options);\n  return new RetryOperation(timeouts, {\n      forever: options && (options.forever || options.retries === Infinity),\n      unref: options && options.unref,\n      maxRetryTime: options && options.maxRetryTime\n  });\n};\n\nexports.timeouts = function(options) {\n  if (options instanceof Array) {\n    return [].concat(options);\n  }\n\n  var opts = {\n    retries: 10,\n    factor: 2,\n    minTimeout: 1 * 1000,\n    maxTimeout: Infinity,\n    randomize: false\n  };\n  for (var key in options) {\n    opts[key] = options[key];\n  }\n\n  if (opts.minTimeout > opts.maxTimeout) {\n    throw new Error('minTimeout is greater than maxTimeout');\n  }\n\n  var timeouts = [];\n  for (var i = 0; i < opts.retries; i++) {\n    timeouts.push(this.createTimeout(i, opts));\n  }\n\n  if (options && options.forever && !timeouts.length) {\n    timeouts.push(this.createTimeout(i, opts));\n  }\n\n  // sort the array numerically ascending\n  timeouts.sort(function(a,b) {\n    return a - b;\n  });\n\n  return timeouts;\n};\n\nexports.createTimeout = function(attempt, opts) {\n  var random = (opts.randomize)\n    ? (Math.random() + 1)\n    : 1;\n\n  var timeout = Math.round(random * Math.max(opts.minTimeout, 1) * Math.pow(opts.factor, attempt));\n  timeout = Math.min(timeout, opts.maxTimeout);\n\n  return timeout;\n};\n\nexports.wrap = function(obj, options, methods) {\n  if (options instanceof Array) {\n    methods = options;\n    options = null;\n  }\n\n  if (!methods) {\n    methods = [];\n    for (var key in obj) {\n      if (typeof obj[key] === 'function') {\n        methods.push(key);\n      }\n    }\n  }\n\n  for (var i = 0; i < methods.length; i++) {\n    var method   = methods[i];\n    var original = obj[method];\n\n    obj[method] = function retryWrapper(original) {\n      var op       = exports.operation(options);\n      var args     = Array.prototype.slice.call(arguments, 1);\n      var callback = args.pop();\n\n      args.push(function(err) {\n        if (op.retry(err)) {\n          return;\n        }\n        if (err) {\n          arguments[0] = op.mainError();\n        }\n        callback.apply(this, arguments);\n      });\n\n      op.attempt(function() {\n        original.apply(obj, args);\n      });\n    }.bind(obj, original);\n    obj[method].options = options;\n  }\n};\n"],"x_google_ignoreList":[0],"mappings":";;;;;CAAA,IAAI;CAEJ,QAAQ,YAAY,SAAS,SAAS;EACpC,IAAI,WAAW,QAAQ,SAAS,QAAQ;AACxC,SAAO,IAAI,eAAe,UAAU;GAChC,SAAS,YAAY,QAAQ,WAAW,QAAQ,YAAY;GAC5D,OAAO,WAAW,QAAQ;GAC1B,cAAc,WAAW,QAAQ;EACpC;CACF;CAED,QAAQ,WAAW,SAAS,SAAS;AACnC,MAAI,mBAAmB,MACrB,QAAO,CAAE,EAAC,OAAO,QAAQ;EAG3B,IAAI,OAAO;GACT,SAAS;GACT,QAAQ;GACR,YAAY,IAAI;GAChB,YAAY;GACZ,WAAW;EACZ;AACD,OAAK,IAAI,OAAO,SACd,KAAK,OAAO,QAAQ;AAGtB,MAAI,KAAK,aAAa,KAAK,WACzB,OAAM,IAAI,MAAM;EAGlB,IAAI,WAAW,CAAE;AACjB,OAAK,IAAI,IAAI,GAAG,IAAI,KAAK,SAAS,KAChC,SAAS,KAAK,KAAK,cAAc,GAAG,KAAK,CAAC;AAG5C,MAAI,WAAW,QAAQ,WAAW,CAAC,SAAS,QAC1C,SAAS,KAAK,KAAK,cAAc,GAAG,KAAK,CAAC;EAI5C,SAAS,KAAK,SAAS,GAAE,GAAG;AAC1B,UAAO,IAAI;EACZ,EAAC;AAEF,SAAO;CACR;CAED,QAAQ,gBAAgB,SAAS,SAAS,MAAM;EAC9C,IAAI,SAAU,KAAK,YACd,KAAK,QAAQ,GAAG,IACjB;EAEJ,IAAI,UAAU,KAAK,MAAM,SAAS,KAAK,IAAI,KAAK,YAAY,EAAE,GAAG,KAAK,IAAI,KAAK,QAAQ,QAAQ,CAAC;EAChG,UAAU,KAAK,IAAI,SAAS,KAAK,WAAW;AAE5C,SAAO;CACR;CAED,QAAQ,OAAO,SAAS,KAAK,SAAS,SAAS;AAC7C,MAAI,mBAAmB,OAAO;GAC5B,UAAU;GACV,UAAU;EACX;AAED,MAAI,CAAC,SAAS;GACZ,UAAU,CAAE;AACZ,QAAK,IAAI,OAAO,IACd,KAAI,OAAO,IAAI,SAAS,YACtB,QAAQ,KAAK,IAAI;EAGtB;AAED,OAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;GACvC,IAAI,SAAW,QAAQ;GACvB,IAAI,WAAW,IAAI;GAEnB,IAAI,UAAU,SAAS,aAAaA,YAAU;IAC5C,IAAI,KAAW,QAAQ,UAAU,QAAQ;IACzC,IAAI,OAAW,MAAM,UAAU,MAAM,KAAK,WAAW,EAAE;IACvD,IAAI,WAAW,KAAK,KAAK;IAEzB,KAAK,KAAK,SAAS,KAAK;AACtB,SAAI,GAAG,MAAM,IAAI,CACf;AAEF,SAAI,KACF,UAAU,KAAK,GAAG,WAAW;KAE/B,SAAS,MAAM,MAAM,UAAU;IAChC,EAAC;IAEF,GAAG,QAAQ,WAAW;KACpBA,WAAS,MAAM,KAAK,KAAK;IAC1B,EAAC;GACH,EAAC,KAAK,KAAK,SAAS;GACrB,IAAI,QAAQ,UAAU;EACvB;CACF"}