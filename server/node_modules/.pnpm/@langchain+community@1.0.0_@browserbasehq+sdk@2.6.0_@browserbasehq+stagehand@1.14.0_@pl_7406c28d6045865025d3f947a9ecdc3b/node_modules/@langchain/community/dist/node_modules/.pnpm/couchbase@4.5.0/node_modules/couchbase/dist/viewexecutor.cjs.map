{"version":3,"file":"viewexecutor.cjs","names":[],"sources":["../../../../../../../../../node_modules/.pnpm/couchbase@4.5.0/node_modules/couchbase/dist/viewexecutor.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ViewExecutor = void 0;\n/* eslint jsdoc/require-jsdoc: off */\nconst bindingutilities_1 = require(\"./bindingutilities\");\nconst streamablepromises_1 = require(\"./streamablepromises\");\nconst viewtypes_1 = require(\"./viewtypes\");\n/**\n * @internal\n */\nclass ViewExecutor {\n    /**\n     * @internal\n     */\n    constructor(bucket) {\n        this._bucket = bucket;\n    }\n    /**\n    @internal\n    */\n    get _cluster() {\n        return this._bucket.cluster;\n    }\n    /**\n     * @internal\n     */\n    query(designDoc, viewName, options) {\n        var _a;\n        const emitter = new streamablepromises_1.StreamableRowPromise((rows, meta) => {\n            return new viewtypes_1.ViewResult({\n                rows: rows,\n                meta: meta,\n            });\n        });\n        const timeout = options.timeout || this._cluster.viewTimeout;\n        const raw = options.raw || {};\n        const ns = (_a = options.namespace) !== null && _a !== void 0 ? _a : viewtypes_1.DesignDocumentNamespace.Production;\n        let fullSet = options.full_set;\n        if (typeof options.fullSet !== 'undefined') {\n            fullSet = options.fullSet;\n        }\n        this._cluster.conn.documentView({\n            timeout: timeout,\n            bucket_name: this._bucket.name,\n            document_name: designDoc,\n            view_name: viewName,\n            ns: (0, bindingutilities_1.designDocumentNamespaceToCpp)(ns),\n            limit: options.limit,\n            skip: options.skip,\n            consistency: (0, bindingutilities_1.viewScanConsistencyToCpp)(options.scanConsistency),\n            keys: options.keys ? options.keys.map((k) => JSON.stringify(k)) : [],\n            key: JSON.stringify(options.key),\n            start_key: options.range && options.range.start\n                ? JSON.stringify(options.range.start)\n                : undefined,\n            end_key: options.range && options.range.end\n                ? JSON.stringify(options.range.end)\n                : undefined,\n            inclusive_end: options.range ? options.range.inclusiveEnd : undefined,\n            start_key_doc_id: options.idRange && options.idRange.start\n                ? options.idRange.start\n                : undefined,\n            end_key_doc_id: options.idRange && options.idRange.end\n                ? options.idRange.end\n                : undefined,\n            reduce: options.reduce,\n            group: options.group,\n            group_level: options.groupLevel,\n            order: (0, bindingutilities_1.viewOrderingToCpp)(options.order),\n            debug: false,\n            query_string: [],\n            raw: raw,\n            full_set: fullSet,\n        }, (cppErr, resp) => {\n            const err = (0, bindingutilities_1.errorFromCpp)(cppErr);\n            if (err) {\n                emitter.emit('error', err);\n                emitter.emit('end');\n                return;\n            }\n            resp.rows.forEach((row) => {\n                emitter.emit('row', new viewtypes_1.ViewRow({\n                    value: JSON.parse(row.value),\n                    id: row.id,\n                    key: JSON.parse(row.key),\n                }));\n            });\n            {\n                const metaData = resp.meta;\n                const meta = new viewtypes_1.ViewMetaData({\n                    totalRows: metaData.total_rows,\n                    debug: metaData.debug_info,\n                });\n                emitter.emit('meta', meta);\n            }\n            emitter.emit('end');\n            return;\n        });\n        return emitter;\n    }\n}\nexports.ViewExecutor = ViewExecutor;\n"],"x_google_ignoreList":[0],"mappings":";;;;;;;;;;CACA,OAAO,eAAe,SAAS,cAAc,EAAE,OAAO,KAAM,EAAC;CAC7D,QAAQ,eAAe,KAAK;CAE5B,MAAM;CACN,MAAM;CACN,MAAM;;;;CAIN,IAAM,eAAN,MAAmB;;;;EAIf,YAAY,QAAQ;GAChB,KAAK,UAAU;EAClB;;;;EAID,IAAI,WAAW;AACX,UAAO,KAAK,QAAQ;EACvB;;;;EAID,MAAM,WAAW,UAAU,SAAS;GAChC,IAAI;GACJ,MAAM,UAAU,IAAI,qBAAqB,qBAAqB,CAAC,MAAM,SAAS;AAC1E,WAAO,IAAI,YAAY,WAAW;KACxB;KACA;IACT;GACJ;GACD,MAAM,UAAU,QAAQ,WAAW,KAAK,SAAS;GACjD,MAAM,MAAM,QAAQ,OAAO,CAAE;GAC7B,MAAM,MAAM,KAAK,QAAQ,eAAe,QAAQ,OAAO,KAAK,IAAI,KAAK,YAAY,wBAAwB;GACzG,IAAI,UAAU,QAAQ;AACtB,OAAI,OAAO,QAAQ,YAAY,aAC3B,UAAU,QAAQ;GAEtB,KAAK,SAAS,KAAK,aAAa;IACnB;IACT,aAAa,KAAK,QAAQ;IAC1B,eAAe;IACf,WAAW;IACX,KAAK,GAAG,mBAAmB,8BAA8B,GAAG;IAC5D,OAAO,QAAQ;IACf,MAAM,QAAQ;IACd,cAAc,GAAG,mBAAmB,0BAA0B,QAAQ,gBAAgB;IACtF,MAAM,QAAQ,OAAO,QAAQ,KAAK,IAAI,CAAC,MAAM,KAAK,UAAU,EAAE,CAAC,GAAG,CAAE;IACpE,KAAK,KAAK,UAAU,QAAQ,IAAI;IAChC,WAAW,QAAQ,SAAS,QAAQ,MAAM,QACpC,KAAK,UAAU,QAAQ,MAAM,MAAM,GACnC;IACN,SAAS,QAAQ,SAAS,QAAQ,MAAM,MAClC,KAAK,UAAU,QAAQ,MAAM,IAAI,GACjC;IACN,eAAe,QAAQ,QAAQ,QAAQ,MAAM,eAAe;IAC5D,kBAAkB,QAAQ,WAAW,QAAQ,QAAQ,QAC/C,QAAQ,QAAQ,QAChB;IACN,gBAAgB,QAAQ,WAAW,QAAQ,QAAQ,MAC7C,QAAQ,QAAQ,MAChB;IACN,QAAQ,QAAQ;IAChB,OAAO,QAAQ;IACf,aAAa,QAAQ;IACrB,QAAQ,GAAG,mBAAmB,mBAAmB,QAAQ,MAAM;IAC/D,OAAO;IACP,cAAc,CAAE;IACX;IACL,UAAU;GACb,GAAE,CAAC,QAAQ,SAAS;IACjB,MAAM,OAAO,GAAG,mBAAmB,cAAc,OAAO;AACxD,QAAI,KAAK;KACL,QAAQ,KAAK,SAAS,IAAI;KAC1B,QAAQ,KAAK,MAAM;AACnB;IACH;IACD,KAAK,KAAK,QAAQ,CAAC,QAAQ;KACvB,QAAQ,KAAK,OAAO,IAAI,YAAY,QAAQ;MACxC,OAAO,KAAK,MAAM,IAAI,MAAM;MAC5B,IAAI,IAAI;MACR,KAAK,KAAK,MAAM,IAAI,IAAI;KAC3B,GAAE;IACN,EAAC;IACF;KACI,MAAM,WAAW,KAAK;KACtB,MAAM,OAAO,IAAI,YAAY,aAAa;MACtC,WAAW,SAAS;MACpB,OAAO,SAAS;KACnB;KACD,QAAQ,KAAK,QAAQ,KAAK;IAC7B;IACD,QAAQ,KAAK,MAAM;GAEtB,EAAC;AACF,UAAO;EACV;CACJ;CACD,QAAQ,eAAe"}