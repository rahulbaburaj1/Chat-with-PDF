{"version":3,"file":"aws_sfn.js","names":["args: AWSSfnToolkitArgs & SfnConfig","llm: BaseLanguageModelInterface","toolkit: AWSSfnToolkit","args?: AWSSfnCreatePromptArgs"],"sources":["../../../src/agents/toolkits/aws_sfn.ts"],"sourcesContent":["import type { BaseLanguageModelInterface } from \"@langchain/core/language_models/base\";\nimport { Toolkit, ToolInterface } from \"@langchain/core/tools\";\nimport { renderTemplate } from \"@langchain/core/prompts\";\nimport { LLMChain } from \"@langchain/classic/chains\";\nimport {\n  AgentExecutor,\n  ZeroShotAgent,\n  ZeroShotCreatePromptArgs,\n} from \"@langchain/classic/agents\";\nimport {\n  SfnConfig,\n  StartExecutionAWSSfnTool,\n  DescribeExecutionAWSSfnTool,\n  SendTaskSuccessAWSSfnTool,\n} from \"../../tools/aws_sfn.js\";\n\n/**\n * Interface for the arguments required to create an AWS Step Functions\n * toolkit.\n */\nexport interface AWSSfnToolkitArgs {\n  name: string;\n  description: string;\n  stateMachineArn: string;\n  asl?: string;\n  llm?: BaseLanguageModelInterface;\n}\n\n/**\n * Class representing a toolkit for interacting with AWS Step Functions.\n * It initializes the AWS Step Functions tools and provides them as tools\n * for the agent.\n * @example\n * ```typescript\n *\n * const toolkit = new AWSSfnToolkit({\n *   name: \"onboard-new-client-workflow\",\n *   description:\n *     \"Onboard new client workflow. Can also be used to get status of any executing workflow or state machine.\",\n *   stateMachineArn:\n *     \"arn:aws:states:us-east-1:1234567890:stateMachine:my-state-machine\",\n *   region: \"<your Sfn's region>\",\n *   accessKeyId: \"<your access key id>\",\n *   secretAccessKey: \"<your secret access key>\",\n * });\n *\n *\n * const result = await toolkit.invoke({\n *   input: \"Onboard john doe (john@example.com) as a new client.\",\n * });\n *\n * ```\n */\nexport class AWSSfnToolkit extends Toolkit {\n  tools: ToolInterface[];\n\n  stateMachineArn: string;\n\n  asl: string;\n\n  constructor(args: AWSSfnToolkitArgs & SfnConfig) {\n    super();\n    this.stateMachineArn = args.stateMachineArn;\n    if (args.asl) {\n      this.asl = args.asl;\n    }\n    this.tools = [\n      new StartExecutionAWSSfnTool({\n        name: args.name,\n        description: StartExecutionAWSSfnTool.formatDescription(\n          args.name,\n          args.description\n        ),\n        stateMachineArn: args.stateMachineArn,\n      }),\n      new DescribeExecutionAWSSfnTool(\n        Object.assign(\n          args.region ? { region: args.region } : {},\n          args.accessKeyId && args.secretAccessKey\n            ? {\n                accessKeyId: args.accessKeyId,\n                secretAccessKey: args.secretAccessKey,\n              }\n            : {}\n        )\n      ),\n      new SendTaskSuccessAWSSfnTool(\n        Object.assign(\n          args.region ? { region: args.region } : {},\n          args.accessKeyId && args.secretAccessKey\n            ? {\n                accessKeyId: args.accessKeyId,\n                secretAccessKey: args.secretAccessKey,\n              }\n            : {}\n        )\n      ),\n    ];\n  }\n}\n\nexport const SFN_PREFIX = `You are an agent designed to interact with AWS Step Functions state machines to execute and coordinate asynchronous workflows and tasks.\nGiven an input question, command, or task use the appropriate tool to execute a command to interact with AWS Step Functions and return the result.\nYou have access to tools for interacting with AWS Step Functions.\nGiven an input question, command, or task use the correct tool to complete the task.\nOnly use the below tools. Only use the information returned by the below tools to construct your final answer.\n\nIf the question does not seem related to AWS Step Functions or an existing state machine, just return \"I don't know\" as the answer.`;\n\nexport const SFN_SUFFIX = `Begin!\n\nQuestion: {input}\nThought: I should look at state machines within AWS Step Functions to see what actions I can perform.\n{agent_scratchpad}`;\n\nexport interface AWSSfnCreatePromptArgs extends ZeroShotCreatePromptArgs {}\n\nexport function createAWSSfnAgent(\n  llm: BaseLanguageModelInterface,\n  toolkit: AWSSfnToolkit,\n  args?: AWSSfnCreatePromptArgs\n) {\n  const {\n    prefix = SFN_PREFIX,\n    suffix = SFN_SUFFIX,\n    inputVariables = [\"input\", \"agent_scratchpad\"],\n  } = args ?? {};\n  const { tools } = toolkit;\n  const formattedPrefix = renderTemplate(prefix, \"f-string\", {});\n\n  const prompt = ZeroShotAgent.createPrompt(tools, {\n    prefix: formattedPrefix,\n    suffix,\n    inputVariables,\n  });\n  const chain = new LLMChain({ prompt, llm });\n  const agent = new ZeroShotAgent({\n    llmChain: chain,\n    allowedTools: tools.map((t) => t.name),\n  });\n  return AgentExecutor.fromAgentAndTools({\n    agent,\n    tools,\n    returnIntermediateSteps: true,\n  });\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA,IAAa,gBAAb,cAAmC,QAAQ;CACzC;CAEA;CAEA;CAEA,YAAYA,MAAqC;EAC/C,OAAO;EACP,KAAK,kBAAkB,KAAK;AAC5B,MAAI,KAAK,KACP,KAAK,MAAM,KAAK;EAElB,KAAK,QAAQ;GACX,IAAI,yBAAyB;IAC3B,MAAM,KAAK;IACX,aAAa,yBAAyB,kBACpC,KAAK,MACL,KAAK,YACN;IACD,iBAAiB,KAAK;GACvB;GACD,IAAI,4BACF,OAAO,OACL,KAAK,SAAS,EAAE,QAAQ,KAAK,OAAQ,IAAG,CAAE,GAC1C,KAAK,eAAe,KAAK,kBACrB;IACE,aAAa,KAAK;IAClB,iBAAiB,KAAK;GACvB,IACD,CAAE,EACP;GAEH,IAAI,0BACF,OAAO,OACL,KAAK,SAAS,EAAE,QAAQ,KAAK,OAAQ,IAAG,CAAE,GAC1C,KAAK,eAAe,KAAK,kBACrB;IACE,aAAa,KAAK;IAClB,iBAAiB,KAAK;GACvB,IACD,CAAE,EACP;EAEJ;CACF;AACF;AAED,MAAa,aAAa,CAAC;;;;;;mIAMwG,CAAC;AAEpI,MAAa,aAAa,CAAC;;;;kBAIT,CAAC;AAInB,SAAgB,kBACdC,KACAC,SACAC,MACA;CACA,MAAM,EACJ,SAAS,YACT,SAAS,YACT,iBAAiB,CAAC,SAAS,kBAAmB,GAC/C,GAAG,QAAQ,CAAE;CACd,MAAM,EAAE,OAAO,GAAG;CAClB,MAAM,kBAAkB,eAAe,QAAQ,YAAY,CAAE,EAAC;CAE9D,MAAM,SAAS,cAAc,aAAa,OAAO;EAC/C,QAAQ;EACR;EACA;CACD,EAAC;CACF,MAAM,QAAQ,IAAI,SAAS;EAAE;EAAQ;CAAK;CAC1C,MAAM,QAAQ,IAAI,cAAc;EAC9B,UAAU;EACV,cAAc,MAAM,IAAI,CAAC,MAAM,EAAE,KAAK;CACvC;AACD,QAAO,cAAc,kBAAkB;EACrC;EACA;EACA,yBAAyB;CAC1B,EAAC;AACH"}