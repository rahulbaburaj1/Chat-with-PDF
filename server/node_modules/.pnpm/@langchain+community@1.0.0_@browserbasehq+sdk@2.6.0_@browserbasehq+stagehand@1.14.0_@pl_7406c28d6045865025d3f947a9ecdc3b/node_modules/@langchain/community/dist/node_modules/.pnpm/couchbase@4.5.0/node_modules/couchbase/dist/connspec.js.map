{"version":3,"file":"connspec.js","names":[],"sources":["../../../../../../../../../node_modules/.pnpm/couchbase@4.5.0/node_modules/couchbase/dist/connspec.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ConnSpec = void 0;\n/* eslint jsdoc/require-jsdoc: off */\nconst qs = __importStar(require(\"querystring\"));\nconst partsMatcher = /((.*):\\/\\/)?(([^/?:]*)(:([^/?:@]*))?@)?([^/?]*)(\\/([^?]*))?(\\?(.*))?/;\nconst hostMatcher = /((\\[[^\\]]+\\]+)|([^;,:]+))(:([0-9]*))?(;,)?/g;\nconst kvMatcher = /([^=]*)=([^&?]*)[&?]?/g;\nclass ConnSpec {\n    constructor(data) {\n        this.scheme = 'couchbase';\n        this.hosts = [['localhost', 0]];\n        this.bucket = '';\n        this.options = {};\n        if (data) {\n            Object.assign(this, data);\n        }\n    }\n    static parse(connStr) {\n        const spec = new ConnSpec();\n        if (!connStr) {\n            return spec;\n        }\n        const parts = partsMatcher.exec(connStr);\n        if (!parts) {\n            return spec;\n        }\n        if (parts[2]) {\n            spec.scheme = parts[2];\n        }\n        else {\n            spec.scheme = 'couchbase';\n        }\n        if (parts[7]) {\n            spec.hosts = [];\n            while (hostMatcher) {\n                const hostMatch = hostMatcher.exec(parts[7]);\n                if (!hostMatch) {\n                    break;\n                }\n                spec.hosts.push([\n                    hostMatch[1],\n                    hostMatch[5] ? parseInt(hostMatch[5], 10) : 0,\n                ]);\n            }\n        }\n        else {\n            throw new Error('a connection string with no hosts is illegal');\n        }\n        if (parts[9]) {\n            spec.bucket = parts[9];\n        }\n        else {\n            spec.bucket = '';\n        }\n        if (parts[11]) {\n            spec.options = {};\n            for (;;) {\n                const kvMatch = kvMatcher.exec(parts[11]);\n                if (!kvMatch) {\n                    break;\n                }\n                const optKey = qs.unescape(kvMatch[1]);\n                const optVal = qs.unescape(kvMatch[2]);\n                if (optKey in spec.options) {\n                    const specOptVal = spec.options[optKey];\n                    if (typeof specOptVal === 'string') {\n                        spec.options[optKey] = [specOptVal, optVal];\n                    }\n                    else {\n                        specOptVal.push(optVal);\n                    }\n                }\n                else {\n                    spec.options[optKey] = optVal;\n                }\n            }\n        }\n        else {\n            spec.options = {};\n        }\n        return spec;\n    }\n    toString() {\n        let connStr = '';\n        if (this.scheme) {\n            connStr += this.scheme + '://';\n        }\n        if (this.hosts.length === 0) {\n            throw new Error('a connection string with no hosts is illegal');\n        }\n        for (let i = 0; i < this.hosts.length; ++i) {\n            const host = this.hosts[i];\n            if (i !== 0) {\n                connStr += ',';\n            }\n            connStr += host[0];\n            if (host[1]) {\n                connStr += ':' + host[1];\n            }\n        }\n        if (this.bucket) {\n            connStr += '/' + this.bucket;\n        }\n        if (this.options) {\n            const optParts = [];\n            for (const optKey in this.options) {\n                const optVal = this.options[optKey];\n                if (typeof optVal === 'string') {\n                    optParts.push(qs.escape(optKey) + '=' + qs.escape(optVal));\n                }\n                else {\n                    for (let optIdx = 0; optIdx < optVal.length; ++optIdx) {\n                        optParts.push(qs.escape(optKey) + '=' + qs.escape(optVal[optIdx]));\n                    }\n                }\n            }\n            if (optParts.length > 0) {\n                connStr += '?' + optParts.join('&');\n            }\n        }\n        return connStr;\n    }\n}\nexports.ConnSpec = ConnSpec;\n"],"x_google_ignoreList":[0],"mappings":"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"}